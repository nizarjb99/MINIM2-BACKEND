<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Login WebApp</title>


    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>


    <link rel="stylesheet" type="text/css" href="index.css">

    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
    <link href="https://unpkg.com/nes.css/css/nes.css" rel="stylesheet" />

    <style>
        html,
        body,
        pre,
        code,
        kbd,
        samp {
            font-family: "./kongtext.ttf";
            background-color: #f2f3f4;
        }

        .item {
            background-color: #f2f3f4;
        }
    </style>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://unpkg.com/nes.css@2.3.0/css/nes.min.css" rel="stylesheet" />
    <link href="https://unpkg.com/nes.css@latest/css/nes.min.css" rel="stylesheet" />
    <link href="https://unpkg.com/nes.css/css/nes-core.min.css" rel="stylesheet" />
</head>

<body>
<div id="nescss" class="item">
    <header class>
        <div class="container navbar-header item">
            <div class="nav-brand item">
                <h1>EETAC BROS</h1>
            </div>
            <ul class="nav navbar-nav">
                <li><a href="/registre">Sign up</a></li>
                <li class="active"><a href="/login">Login</a></li>
            </ul>
        </div>
    </header>

    <div class="container">
        <div class="row">
            <div class="col-sm-3"></div>

            <div class="col-sm-3">
                <section class="showcase">
                    <div class="nes-container with-title" id="app">
                        <h3 class="title">Login</h3>

                        <div class="nes-field">
                            <label for="loginUsernameTbx">Username:</label>
                            <input type="text" class="nes-input" id="loginUsernameTbx">
                        </div>

                        <div class="nes-field">
                            <label for="loginPasswordTbx">Password:</label>
                            <input type="password" class="nes-input" id="loginPasswordTbx">
                        </div>

                        <hr />
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-sm-6">
                                    <button class="nes-btn is-warning" id="loginClearBtn">
                                        Clear
                                    </button>
                                </div>
                                <div class="col-sm-6">
                                    <button class="nes-btn is-success" id="loginBtn">
                                        Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="col-sm-3 fbox">
                <div id="cursor" class="item">
                    <p class="nes-balloon from-left nes-pointer" style="display: none" id="res">
                        Loading...
                    </p>
                </div>
            </div>
        </div>
    </div>

</div>


<script>

     const BASE_URL = "http://localhost:8080/example/eetacbros/user/login";

     function onClearBtnClick() {
         $("#loginUsernameTbx").val('');
         $("#loginPasswordTbx").val('');
     }

     function onLoginBtnClick() {
         console.log("loginBtn clicked!");

         let username = $("#loginUsernameTbx").val();
         let password = $("#loginPasswordTbx").val();
         let name = null;
         let email = null;

         if (!username || !password) {
             showBubble("Cal omplir usuari i contrasenya!");
             return;
         }

         let credentials = { username: username, password: password };

         $.postJSON(BASE_URL, credentials, (data, status) => {
             console.log(`Status: ${status}`);

             // üëâ Aqu√≠ surt EXACTAMENT igual que al registre ‚Äúsuccess‚Äù
             showBubble(status);

         }).fail((jqXHR) => {

             if (jqXHR.status === 400) {
                 showBubble("Contrasenya incorrecta!");
             } else if (jqXHR.status === 404) {
                showBubble("No s'ha trobat l'usuari!");
             } else {
                 showBubble("Error del servidor o de connexi√≥!");
             }
         });
     }

     function onReadyDocument() {
         console.log("Initializing LOGIN...");
         $("#loginClearBtn").click(onClearBtnClick);
         $("#loginBtn").click(onLoginBtnClick);
     }

     function showBubble(text) {
         $("#res").fadeIn("slow");
         $("#res").text(text);
         $("#res").delay(3000).fadeOut("slow");
     }

     $.postJSON = function (url, data, callback) {
         return jQuery.ajax({
             headers: {
                 'Accept': 'application/json',
                 'Content-Type': 'application/json'
             },
             type: 'POST',
             url: url,
             data: JSON.stringify(data),
             dataType: 'json',
             success: callback
         });
     };

     $(document).ready(onReadyDocument);
</script>

</body>
</html>
